<html>
<head>
  <title>Login SIAKAD Polinema</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="login-body">
  <div class="login-container">
    <div class="login-left">
      <div class="kotak">
        <img src="images/Logo-Polinema.png" alt="Logo Polinema" class="logo">
        <h3 class="judul">LOGIN SIAKAD POLINEMA</h3>
      </div>
      <div class="login-form">
        <p>Masukkan Username dan Password<br>(Menggunakan NIM dan Password)</p>
        
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">

        <div class="checkbox">
          <input type="checkbox" id="showPass" onclick="togglePassword()">
          <label for="showPass">Tampilkan Password</label>
        </div>

        <button onclick="handleLogin()" class="button">LOGIN</button>

        <p id="errorMessage" style="color: red; margin-top: 10px;"></p>
      </div>
    </div>
    <div class="login-right"></div>
  </div>

  <script>
    // Fungsi untuk menampilkan/menyembunyikan password (tetap sama)
    function togglePassword() {
      const pass = document.getElementById("password");
      pass.type = pass.type === "password" ? "text" : "password";
    }

    // Fungsi BARU untuk menangani proses login
    async function handleLogin() {
      const usernameInput = document.getElementById('username');
      const passwordInput = document.getElementById('password');
      const errorMessage = document.getElementById('errorMessage');

      // 1. Ambil data dari form
      const loginData = {
        username: usernameInput.value,
        password: passwordInput.value
      };

      // Hapus pesan error sebelumnya
      errorMessage.textContent = '';

      try {
        // 2. Kirim data ke backend menggunakan Fetch API
        const response = await fetch('http://localhost:3000/login', {
          method: 'POST', // Metode request
          headers: {
            'Content-Type': 'application/json' // Tipe konten
          },
          body: JSON.stringify(loginData) // Ubah data ke format JSON
        });

        const result = await response.json(); // Baca respons dari server

        // 3. Proses respons dari backend
        if (response.ok) { // Jika status HTTP 200-299
          window.location.href = 'dashboard.html'; 
        } else {
          // Tampilkan pesan error dari server
          errorMessage.textContent = result.message;
        }
      } catch (error) {
        // Tangani jika server tidak bisa dihubungi
        console.error('Error:', error);
        errorMessage.textContent = 'Tidak dapat terhubung ke server. Coba lagi nanti.';
      }
    }
  </script>
</body>
</html>